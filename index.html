<html>
    <head>
        <meta name="viewport" content="width=device-width">
        <title>ArCo Visualization</title>
        <!--Bootstrap-->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/>
        <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <!--Map-->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"/>
        <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.5.0/proj4.js"></script>
    </head>
    <body>
        <div id="map" style="height: 500; width: 100%;">

        </div>
    </body>
    <script>
    $(document).ready(function() {

        var map = L.map('map', {
        maxZoom: 16,
        minZoom: 6,
        maxBoundsViscosity: 1.0
        });
        map.setView([46.0160, 13.1611], 7);
        var osm = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        }).addTo(map);

        var layerGroup = L.layerGroup().addTo(map);
 
        $.ajax({
            dataType: "json",
            url: "GeoLocatedCultEnt.json",
            success: function(data) {
                data.results.bindings.forEach(function(arrayItem) {
                    try {
                            var itemcoord = [arrayItem.lat.value, arrayItem.long.value]
                            itemmarker = L.marker(itemcoord).addTo(layerGroup);
                            itemmarker.bindPopup('<h4>'+ arrayItem.label.value + '</h4><a href="'+ arrayItem.entity.value + '"> LINK</a>');
                        }
                        catch(error) {
                            console.log(error);
                        }
                    try {
                        proj4.defs("EPSG:3003","+proj=tmerc +lat_0=0 +lon_0=9 +k=0.9996 +x_0=1500000 +y_0=0 +ellps=intl +towgs84=-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68 +units=m +no_defs");
                        Proj4js.defs["WGS84"] = "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs";

                        var dest = new Proj4js.Proj('WGS84');    
                        var source = new Proj4js.Proj('EPSG:3003');
                        
                        var testPt = new Proj4js.Point(arrayItem.lat.value, arrayItem.long.value);
                        
                        var coordnew = Proj4js.transform(source, dest, testPt);
                        itemmarker = L.marker(coordnew).addTo(layerGroup);

                    }
                    catch(error) {
                            console.log(error);
                        }
                    try {
                            var latinput = arrayItem.lat.value
                            var longinput = arrayItem.long.value
                            var latparts = input.split(/[^\d\w]+/);
                            var lat = ConvertDMSToDD(latparts[0], latparts[1], latparts[2], latparts[3]);
                            var longparts = input.split(/[^\d\w]+/);
                            var long = ConvertDMSToDD(longparts[0], longparts[1], longparts[2], longparts[3]);

                            var itemcoord = [lat, long]
                            itemmarker = L.marker(itemcoord).addTo(layerGroup);
                            itemmarker.bindPopup('<h4>'+ arrayItem.label.value + '</h4><a href="'+ arrayItem.entity.value + '"> LINK</a>');
                    
                        function ConvertDMSToDD(degrees, minutes, seconds, direction) {
                            var dd = degrees + minutes/60 + seconds/(60*60);

                            if (direction == "S" || direction == "W") {
                                dd = dd * -1;
                            } // Don't do anything for N or E
                            return dd;
                        }
                    }
                    catch(error) {
                            console.log(error);
                        }
                })

            }
        })
    })
    </script>
</html>


<!--aggiornaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa-->